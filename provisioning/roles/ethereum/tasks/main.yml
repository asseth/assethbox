---

- name: install requirements for geth
  apt: pkg=software-properties-common state=present

- name: add ethereum ppa
  apt_repository: repo='ppa:ethereum/ethereum' update_cache=yes

- name: install geth
  apt: pkg=ethereum state=present

- name: check parity installed
  stat: path=/snap/bin/parity
  register: parity_installed

- name: install parity
  command: snap install parity
  when: not parity_installed.stat.exists

- name: install requirements for populus
  apt: pkg={{ item }} state=present
  with_items:
    - libssl-dev

- name: Install populus
  pip: name=populus executable=pip3

- name: Upgrade web3 (fix populus) # temporary fix for populus waiting for a fix https://github.com/ethereum/populus/issues/450
  pip:
    executable: pip3
    name: pip
    extra_args: --upgrade web3

- name: check truffle installed
  stat: path=/opt/node-{{ node_version }}-linux-x64/lib/node_modules/truffle
  register: truffle_installed

- name: install truffle
  command: npm -g install truffle --unsafe-perm
  when: not truffle_installed.stat.exists

- name: check ganache_cli installed
  stat: path=/opt/node-{{ node_version }}-linux-x64/lib/node_modules/ganache-cli
  register: ganache_cli_installed

- name: install ganache-cli
  command: npm -g install ganache-cli
  when: not ganache_cli_installed.stat.exists
